<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Rubik&display=swap" rel="stylesheet" />

  <title>Rocketseat - React.js - Fundamentos</title>

  <style type="text/tailwindcss">
    @theme {
      --text: #EBEBEB;
      --text-secondary: #6B6B6B;
      --primary: #462878;
      --background: #2D2A37;

      --gradient: 180deg, 
        rgba(0, 0, 0, 0.05) 0%, 
        rgba(255, 255, 255, 0.05) 100%;

      --gradient-hover: 180deg, 
        rgba(0, 0, 0, 0.1) 0%, 
        rgba(255, 255, 255, 0.1) 100%;

      --shadow: 0px 11px 7px 0px rgba(0, 0, 0, 0.01), 
        0px 7px 7px 0px rgba(0, 0, 0, 0.04), 
        0px 4px 6px 0px rgba(0, 0, 0, 0.10), 
        0px 2px 4px 0px rgba(0, 0, 0, 0.26), 
        0px 0px 2px 0px rgba(0, 0, 0, 0.29), 
        0px 2px 3px 0px rgba(255, 255, 255, 0.06) inset;

      --font-sans: 'Rubik', sans-serif;
    }
  </style>
</head>

<body class="bg-linear-[180deg,_#807ECE_0%,_#807ECE_100%] min-h-screen text-(--text) font-(--font-sans)">
  <div id="root"></div>

  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const textVariants = {
      default: 'text-xl',
      muted: 'text-xl text-(--text-secondary)',
      heading: 'text-2xl',
      blast: 'text-3xl',
    }

    function Text({
      as = 'span',
      variant = 'default',
      className,
      children,
      ...props
    }) {
      return React.createElement(
        as,
        {
          className: `${textVariants[variant]} ${className ? className : ''}`,
          ...props
        },
        children
      )
    }

    const buttonVariants = {
      default: 'bg-(--background)',
      primary: 'bg-(--primary)'
    }

    function Button({
      variant = 'default',
      className,
      children,
      ...props
    }) {
      return (
        <Text
          as="button"
          variant="heading"
          className={`
            flex items-center justify-center rounded-xl
            p-3 cursor-pointer text-(--text) 
            bg-linear-(--gradient) 
            hover:bg-linear-(--gradient-hover)
            shadow-(--shadow)
            ${buttonVariants[variant]}
            ${className ? className : ''}
          `}
          {...props}
        >
          {children}
        </Text>
      )
    }

    function Card({ children, className, ...props }) {
      return (
        <div className={`
            bg-(--background) shadow-(--shadow)
            rounded-2xl
            ${className ? className : ''}
          `}>
          {children}
        </div>
      )
    }

    const buttons = [
      [
        { input: "CE" },
        { input: "C", className: "flex-1 h-16" },
        { input: "/", variant: "primary" }
      ],
      [
        { input: "7" },
        { input: "8" },
        { input: "9" },
        { input: "*", variant: "primary" },
      ],
      [
        { input: "4" },
        { input: "5" },
        { input: "6" },
        { input: "-", variant: "primary" },
      ],
      [
        { input: "1" },
        { input: "2" },
        { input: "3" },
        { input: "+", variant: "primary" },
      ],
      [
        { input: "0", className: "flex-1 h-16" },
        { input: "," },
        { input: "=", className: "w-16 h-16 bg-[#7f45e2]" },
      ]
    ]

    const CalculatorContext = React.createContext()

    function CalculatorProvider({ children }) {
      const [history, setHistory] = React.useState([]);
      const historyStorageKey = 'history'

      function updateHistory(operation, parsedResult) {
        setHistory((prev) => {
          const updatedHistory = [...prev, `${operation}=${parsedResult}`]

          localStorage.setItem(historyStorageKey, JSON.stringify(updatedHistory))

          return updatedHistory
        })
      }

      React.useEffect(() => {
        const savedHistory = localStorage.getItem(historyStorageKey, JSON.stringify(history))
        setHistory(JSON.parse(savedHistory || '[]'))
      }, [])


      return (
        <CalculatorContext.Provider
          value={{ history, updateHistory }}
        >
          {children}
        </CalculatorContext.Provider>
      )
    }

    function useCalculator() {
      const [operation, setOperation] = React.useState('');
      const [result, setResult] = React.useState('')
      const { updateHistory } = React.useContext(CalculatorContext)

      function doOperation(input) {
        if (input === 'C') {
          setOperation("");
          setResult("");
          return
        }

        if (input === 'CE') {
          setResult("");
          setOperation(operation.slice(0, -1));
          return;
        }

        if (input === '=') {
          const operationResult = eval(operation.replace(/,/g, '.'));
          const parsedResult = operationResult.toString()?.replace(/\./g, ',')
          setResult(parsedResult)
          updateHistory(operation, parsedResult)

          return;
        }

        if (result) {
          setOperation(isNaN(input) ? `${result}${input}` : input)
          setResult('');
          return;
        }

        if (input === ',' && !operation.endsWith(',')) {
          setOperation(`${operation},`);
          return;
        }

        setOperation(`${operation}${input}`)
      }

      return {
        operation,
        result,
        doOperation
      }
    }

    function CalculatorDisplay({ operation, result }) {
      return (
        <div className={`
              flex flex-col gap-2 px-[1.375rem]
              cursor-default select-none
            `}>
          <Text
            as="div"
            variant="muted"
            className="flex items-center justify-end h-7"
          >
            {result && operation}
          </Text>
          <div className={`
              flex items-center justify-between h-9
              `}>
            <Text
              variant="muted"
            >
              =
            </Text>
            <Text
              variant="blast"
            >
              {result || operation}
            </Text>
          </div>
        </div>
      )
    }

    function Calculator() {
      const { operation, result, doOperation } = useCalculator()

      function handleInputClick(input) {
        doOperation(input)
      }

      return (
        <Card className={`
          flex flex-col gap-[1.625rem] w-[22.25rem]
          pt-14 px-8 pb-8
          `}>
          <CalculatorDisplay
            operation={operation}
            result={result}
          />

          <div className="flex flex-col gap-3">
            {buttons.map((row, index) => (
              <div key={`row-${index}`} className="flex gap-3">
                {row.map(button => (
                  <Button
                    key={button.input}
                    className={button.className || "w-16 h-16"}
                    variant={button.variant}
                    onClick={() => handleInputClick(button.input)}
                  >
                    {button.input}
                  </Button>
                ))}
              </div>

            ))}
          </div>
        </Card>
      )
    }

    function OperationHistory() {
      const { history } = React.useContext(CalculatorContext)

      return (
        <Card className="w-full py-10 px-8">
          <Text
            as="h1"
            variant="heading"
            className="mb-4"
          >
            Histórico de Operações
          </Text>

          {history.length > 0 ? (
            <ul className="flex flex-col gap-3">
              {history.map((value, index) => (
                <Text key={`item-${index}`} as="li">{value}</Text>
              ))}
            </ul>
          ) : (
            <Text as="p" variant="muted">Nenhuma operação recente.</Text>
          )}
        </Card>
      )
    }

    function App() {
      return (
        <main className={`
          py-28 px-4 sm:px-10
          flex flex-col sm:flex-row
          items-center sm:items-stretch
          gap-2
          `}>
          <CalculatorProvider>
            <Calculator />
            <OperationHistory />
          </CalculatorProvider>
        </main>
      )
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />)
  </script>
  <!--
    - sm: aplica a partir do breakpoint pequeno (>= 640px).
    - hover: aplica quando o mouse está sobre o elemento.
    - (...): usa o valor de uma variável CSS definida em @theme.
    - [valor]: usa um valor arbitrário (ex.: rem, px, deg).

    Definições de tema (@theme no <style type="text/tailwindcss">):
    - --text, --text-secondary: cores de texto.
    - --primary: cor principal (botões/ações).
    - --background: cor de fundo dos cartões.
    - --gradient, --gradient-hover: parâmetros do gradiente.
    - --shadow: conjunto de sombras.
    - --font-sans: família de fonte.

    Layout (Flexbox):
    - flex: ativa o layout flexível.
    - flex-col: empilha filhos em coluna (de cima para baixo).
    - items-center: alinha itens ao centro no eixo transversal (vertical em linha, horizontal em coluna).
    - items-stretch: faz os filhos ocuparem toda a altura/largura disponível no eixo transversal.
    - justify-center: centraliza no eixo principal.
    - justify-end: alinha ao fim do eixo principal (direita em linha, baixo em coluna).
    - justify-between: coloca o primeiro à esquerda, o último à direita, espaço entre os demais.
    - flex-1: faz o elemento crescer para ocupar espaço disponível.

    Espaçamento:
    - gap-2, gap-3, gap-[1.625rem]: espaço entre filhos em layouts flex/grade.
    - px-[1.375rem], px-8, px-4, px-10 (com sm:): padding horizontal.
    - py-10, py-28: padding vertical.
    - pt-14, pb-8: padding topo/baixo.
    - mb-4: margem inferior.

    Tamanho:
    - w-[22.25rem]: largura com valor arbitrário.
    - w-16, h-16: largura/altura fixas (4rem cada).
    - w-full: ocupa 100% da largura disponível.
    - min-h-screen: altura mínima igual à altura da janela.

    Tipografia:
    - text-xl, text-2xl, text-3xl: tamanhos de fonte crescentes.
    - text-(--text): cor de texto vinda da variável --text.
    - text-(--text-secondary): cor de texto secundária (--text-secondary).
    - font-(--font-sans): família de fonte definida em --font-sans.

    Cores, fundo e gradientes:
    - bg-(--background): fundo usando a variável --background.
    - bg-(--primary): fundo usando a variável --primary (botão de ação).
    - bg-linear-[180deg,_#807ECE_0%,_#807ECE_100%]: gradiente definido inline (direção + cores).
    - bg-linear-(--gradient): gradiente usando os parâmetros da variável --gradient.
    - hover:bg-linear-(--gradient-hover): muda o gradiente ao passar o mouse.

    Bordas e sombras:
    - rounded-xl, rounded-2xl: cantos arredondados (mais ou menos curvos).
    - shadow-(--shadow): aplica o conjunto de sombras definidas em --shadow.

    Comportamento/Interação:
    - cursor-pointer: cursor de mão (indicando que dá para clicar).
    - cursor-default: cursor padrão (indica que não é clicável).
    - select-none: impede selecionar texto com o mouse.

    Responsividade:
    - sm:flex-row: em telas pequenas para cima, os itens ficam lado a lado (linha).
    - sm:px-10: aumenta o padding horizontal em telas >= 640px.
    - sm:items-stretch: estica os itens no eixo transversal em telas >= 640px.

    Padrões que funcionam juntos:
    - Centralizar totalmente um conteúdo: "flex items-center justify-center".
      Isso liga o modo flex e põe tudo no centro, tanto no eixo principal quanto no transversal.
    - Alinhar conteúdo à direita: "flex justify-end".
      Útil para alinhar números/resultado no display da calculadora.
    - Distribuir botões com espaçamento: "flex gap-3".
      Cria linhas/colunas de botões com respiro confortável entre eles.
    - Linha de itens espalhados: "flex justify-between".
      Coloca itens nas extremidades com espaço entre eles.
    - Coluna com respiro: "flex flex-col gap-2" ou "gap-[1.625rem]".
      Empilha elementos e cria espaço vertical.
    - Cartão visual: "bg-(--background) shadow-(--shadow) rounded-2xl".
      Dá fundo, sombra e cantos arredondados — aspecto de card.
    - Botão principal: "bg-(--primary) text-(--text) rounded-xl shadow-(--shadow)".
      Realça ação, mantém legibilidade e dá profundidade.
    - Efeito hover suave: "bg-linear-(--gradient)" + "hover:bg-linear-(--gradient-hover)".
      O fundo ganha um leve brilho quando o mouse passa por cima.
    - Tornar texto não selecionável em displays: "cursor-default select-none".
      Evita que o usuário selecione o texto do visor sem querer.
    - Layout responsivo: "flex flex-col sm:flex-row items-center sm:items-stretch".
      Em telas menores, fica em coluna; em telas maiores, lado a lado e bem alinhado.
  -->
</body>

</html>